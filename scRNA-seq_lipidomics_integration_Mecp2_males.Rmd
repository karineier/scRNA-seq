---
title: "Integration of scRNA-seq and Lipidomics Data - Mecp2 Project"
author: "Kari Neier"
date: "9/14/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

```

## Background

This experiment is designed to characterize transcriptomic profiles of Mecp2-e1 mutant vs. wild-type mice in the brain at the single-cell level. In addition, we also have lipidomic data from brain tissue of these same mice, and are interested in determining the following:

1) Which cell types have the strongest associations between gene expression and lipids that were differentially abundant in Mecp2-e1 mutants vs. wild-types?
2) Which genes are associated with brain lipids in diferent cell types? Are these genes also differentially expressed in Mecp2-e1 mutant vs. wild-types?

### Approach

Use limma to evaluate associations between lipids and gene expression, stratified by cell type. 

### The Data

- Labeled Lipids from an untargeted lipidomic analysis of brain tissue from male Mecp2-e1 mutants and wild-type littermate controls
- scRNA-seq data generated by Osman with data processed and cells labeled 

## Setting up

Loading packages, loading in the Seurat Object that was generated by Osman, and loading brain lipidomics data

```{r setting_up}
library(Seurat)
library(limma)
library(ggplot2)

load("/Users/karineier/Documents/Mecp2/scRNA-seq/rett_P120_with_labels_proportions3.rda")

brain_lipids = read.csv("/Users/karineier/Documents/Mecp2/Brain_Lipidomics/Males_Brain_semiquant_data_normalized.csv")

brain_lipids_stats = read.csv("/Users/karineier/Documents/Mecp2/Brain_Lipidomics/Males_Brain_Lipidomics_Semiquant_t_test_annotated.csv") # contains p-values and FDRs for brain lipids in males

```

## Formatting lipidomic data

Reorganizing lipidomic data for use in limma and filtering out lipids with p-value >0.05. Also removing data from animals without scRNA-seq data available.

```{r lipidomic_data_formatting}
brain_lipids.0 = as.data.frame(t(brain_lipids[-1,-1]))
colnames(brain_lipids.0) = gsub("\\[M.*", "", brain_lipids$X[-1])
rownames(brain_lipids.0) = gsub("X", "19-0", rownames(brain_lipids.0))

brain_lipids_stats$Annotation = gsub("\\[M.*", "", brain_lipids_stats$Annotation)

brain_lipids_sig = brain_lipids_stats$Annotation[which(brain_lipids_stats$p.value<0.05)]

brain_lipids.1 = brain_lipids.0[,brain_lipids_sig]

scRNAseq_animal_IDs = c("19-0112", "19-0113", "19-0114", "19-0117")

brain_lipids.2 = brain_lipids.1[scRNAseq_animal_IDs,]

```







